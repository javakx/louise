<html>
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	<script type="module">		
		class AppStateVerbose extends AppState {
			constructor() {
				super();
				console.log('constructor:length',this.initialHistoryStateLength);
			}

			anno(a) {
				console.log(`-- ${a} --`);
				return this;
			}
			
			pushScreen(screen,params=null) {
				return super.pushScreen(screen,params).then((states) => {
					console.log('pushScreen:oldScreen,newScreen',states.oldState?.appURLState,states.newState?.appURLState);
				});
			}
			replaceScreen(screen,params) {
				return super.replaceScreen(screen,params).then((states) => {
					console.log('replaceScreen:oldState,newState',states.oldState?.appURLState,states.newState?.appURLState);
				});
			}
			changeParams(params) {
				let state = this.peekScreen();
				let screen = state?state.screen:null;
				if(!screen) {
					throw new Error('No screen set, stack empty.');
				}
				return super.replaceScreen(screen,params).then((states) => {
					console.log('changeParams:oldState,newState',states.oldState?.appURLState,states.newState?.appURLState);
				});
			}
			popScreen() {
				return super.popScreen().then((states) => {
					console.log('popScreen:oldState,newState',states.oldState?.appURLState,states.newState?.appURLState);
				});
			}
		}
		
		function test1(appState) {
			return appState.anno('First set').pushScreen('screen1')
				.then(() => {
					return appState.anno('Update params').pushScreen('screen1',{param1:"1",param2:"2"});
				})
				.then(() => {
					return appState.anno('Second screen').pushScreen('screen2');
				})
				.then(() => {
					return appState.anno('Pop second screen').popScreen();
				})
				.then(() => {
					return appState.anno('Third screen replaces first').replaceScreen('screen3',{paramA:'A',paramB:'B'});
				})
				.then(() => {
					return appState.anno('Change params').changeParams({param1:-1,param2:-2});
				})
				.then(() => {
					return appState.anno('Pop third screen').popScreen();
				});
		}
		
		import { AppState } from '../src/AppState.js';
		$(document).ready(() => {
			let appState = new AppStateVerbose();
			test1(appState);
		});
	</script>
</head>
<body>
</body>
</html>
